<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Registration - LocalCricbuzz</title>
    <link rel="stylesheet" href="cricbuzz-style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                üèè <a href="index.html" style="color: white; text-decoration: none;">LocalCricbuzz</a>
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="tournaments.html">Tournaments</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Registration Form -->
    <div class="container">
        <div style="max-width: 600px; margin: 2rem auto;">
            <!-- Header Card -->
            <div class="reg-card">
                <h1>üèÜ Tournament Registration</h1>
                <div class="price">‚Çπ1000</div>
                <p>Register ‡§ï‡§∞‡§æ ‡§Ü‡§£‡§ø India ‡§≠‡§∞ ‡§ö‡•ç‡§Ø‡§æ tournaments ‡§Æ‡§ß‡•ç‡§Ø‡•á play ‡§ï‡§∞‡§æ!</p>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <strong>üìù Registration Process:</strong><br>
                1. Details ‡§≠‡§∞‡§æ + ‚Çπ1000 pay ‡§ï‡§∞‡§æ<br>
                2. ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ SMS ‡§µ‡§∞ CODE ‡§Æ‡§ø‡§≥‡•á‡§≤<br>
                3. Admin approve ‡§ï‡§∞‡•á‡§≤<br>
                4. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä login ‡§ï‡§∞‡•Ç‡§® scoring ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§æ‡§≤!
            </div>

            <!-- Form -->
            <div class="score-panel">
                <form id="registrationForm">
                    <div class="form-group">
                        <label>Tournament ‡§®‡§ø‡§µ‡§°‡§æ *</label>
                        <select id="tournamentSelect" class="form-control" required>
                            <option value="">Loading tournaments...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Team ‡§®‡§æ‡§µ *</label>
                        <input type="text" id="teamName" class="form-control" required placeholder="‡§â‡§¶‡§æ. Mumbai Warriors">
                    </div>

                    <div class="form-group">
                        <label>Captain ‡§®‡§æ‡§µ *</label>
                        <input type="text" id="captainName" class="form-control" required placeholder="‡§â‡§¶‡§æ. Rahul Sharma">
                    </div>

                    <div class="form-group">
                        <label>Mobile Number * (10 digits)</label>
                        <input type="tel" id="mobile" class="form-control" required pattern="[0-9]{10}" placeholder="9876543210">
                        <small style="color: #666;">‡§π‡§æ number ‡§§‡•Å‡§Æ‡§ö‡§æ login ID ‡§Ö‡§∏‡•á‡§≤!</small>
                    </div>

                    <div class="form-group">
                        <label>City</label>
                        <input type="text" id="city" class="form-control" placeholder="‡§â‡§¶‡§æ. Mumbai">
                    </div>

                    <button type="submit" class="submit-btn">
                        ‚Çπ1000 Pay ‡§ï‡§∞‡•Ç‡§® Register ‡§ï‡§∞‡§æ
                    </button>
                </form>
            </div>

            <div class="success-box" style="display: none; margin-top: 1rem;" id="successMessage">
                <strong>‚úÖ Registration Successful!</strong><br>
                ‡§§‡•Å‡§Æ‡§ö‡§æ verification code SMS ‡§µ‡§∞ ‡§™‡§æ‡§†‡§µ‡§≤‡§æ ‡§Ü‡§π‡•á.<br>
                Admin approve ‡§ï‡•á‡§≤‡•ç‡§Ø‡§æ‡§µ‡§∞ ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä login ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§æ‡§≤!
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2026 LocalCricbuzz</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="js/config.js"></script>
    <script>
        // Load Active Tournaments
        db.ref('tournaments').orderByChild('status').equalTo('active').on('value', (snapshot) => {
            const select = document.getElementById('tournamentSelect');
            select.innerHTML = '<option value="">Select Tournament</option>';
            
            if (!snapshot.exists()) {
                select.innerHTML = '<option value="">‡§ï‡•ã‡§£‡§§‡•á‡§π‡•Ä active tournaments ‡§®‡§æ‡§π‡•Ä‡§§</option>';
                return;
            }
            
            snapshot.forEach((childSnapshot) => {
                const tournament = childSnapshot.val();
                const option = document.createElement('option');
                option.value = childSnapshot.key;
                option.textContent = `${tournament.name} - ${tournament.location} (‚Çπ${tournament.registrationFee})`;
                select.appendChild(option);
            });
        });

        // Generate Code
        function generateCode() {
            return Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        // Form Submit
        document.getElementById('registrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const tournamentId = document.getElementById('tournamentSelect').value;
            if (!tournamentId) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ tournament ‡§®‡§ø‡§µ‡§°‡§æ!');
                return;
            }

            const code = generateCode();
            const mobile = document.getElementById('mobile').value;
            
            const regData = {
                tournamentId: tournamentId,
                teamName: document.getElementById('teamName').value,
                captainName: document.getElementById('captainName').value,
                mobile: mobile,
                city: document.getElementById('city').value,
                verificationCode: code,
                status: 'pending',
                paymentStatus: 'pending',
                registrationDate: new Date().toLocaleDateString('en-IN'),
                timestamp: Date.now()
            };

            // Payment Confirmation
            const confirmed = confirm(
                `Registration Details:\n\n` +
                `Tournament: ${document.querySelector('#tournamentSelect option:checked').textContent}\n` +
                `Team: ${regData.teamName}\n` +
                `Captain: ${regData.captainName}\n` +
                `Mobile: ${regData.mobile}\n` +
                `Fee: ‚Çπ1000\n\n` +
                `Proceed to payment?`
            );

            if (!confirmed) return;

            try {
                const btn = document.querySelector('.submit-btn');
                btn.disabled = true;
                btn.textContent = 'Processing...';

                // Save Registration
                const newRegRef = db.ref('registrations').push();
                await newRegRef.set(regData);

                // Create User Account (for login)
                const userRef = db.ref('users/' + mobile);
                await userRef.set({
                    mobile: mobile,
                    name: regData.captainName,
                    teamName: regData.teamName,
                    registrationId: newRegRef.key,
                    role: 'user',
                    status: 'pending',
                    createdAt: Date.now()
                });

                // Show Success
                document.getElementById('registrationForm').style.display = 'none';
                const successMsg = document.getElementById('successMessage');
                successMsg.style.display = 'block';
                successMsg.innerHTML = `
                    <strong>‚úÖ Registration Successful!</strong><br><br>
                    <strong>Your Verification Code:</strong><br>
                    <div style="background: white; padding: 1rem; border-radius: 4px; font-size: 2rem; font-weight: bold; text-align: center; margin: 1rem 0; color: #09aa34; letter-spacing: 5px;">
                        ${code}
                    </div>
                    <strong>Important:</strong><br>
                    ‚Ä¢ ‡§π‡§æ code SMS ‡§µ‡§∞ ‡§™‡§£ ‡§Æ‡§ø‡§≥‡•á‡§≤<br>
                    ‚Ä¢ Admin ‡§≤‡§æ code ‡§∏‡§æ‡§Ç‡§ó‡§æ approval ‡§∏‡§æ‡§†‡•Ä<br>
                    ‚Ä¢ Approve ‡§ù‡§æ‡§≤‡•ç‡§Ø‡§æ‡§µ‡§∞ ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä <strong>${mobile}</strong> ‡§®‡•á login ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§æ‡§≤<br><br>
                    <a href="user/login.html" class="btn btn-primary">Login Page</a>
                `;

                // Note: Production ‡§Æ‡§ß‡•ç‡§Ø‡•á SMS API integrate ‡§ï‡§∞‡§æ
                console.log('SMS to send:', mobile, code);

            } catch (error) {
                alert('Error: ' + error.message);
                btn.disabled = false;
                btn.textContent = '‚Çπ1000 Pay ‡§ï‡§∞‡•Ç‡§® Register ‡§ï‡§∞‡§æ';
            }
        });
    </script>
</body>
</html>
